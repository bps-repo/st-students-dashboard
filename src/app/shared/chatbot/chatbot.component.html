<div class="chat-history-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Conversas</h2>
      <button class="new-chat-btn" (click)="createNewChat()">
        <span class="material-icons">add</span>
        <span>Novo chat</span>
      </button>
    </div>

    <div class="conversations-list">
      <div *ngIf="isLoading()" class="loading-spinner">
        <span class="material-icons spinning">refresh</span>
        <p>Carregando conversas...</p>
      </div>

      <div *ngIf="!isLoading() && conversations().length === 0" class="empty-state">
        <span class="material-icons">chat_bubble_outline</span>
        <p>Sem conversas ainda!</p>
        <small>Clica "Novo Chat" para começar</small>
      </div>

      <div
        *ngFor="let conversation of conversations()"
        class="conversation-item"
        [class.active]="selectedConversation()?.id === conversation.id"
        (click)="selectConversation(conversation)">

        <div class="conversation-icon">
          <span class="material-icons">chat</span>
        </div>

        <div class="conversation-info">
          <h4>{{ getConversationPreview(conversation) }}</h4>
          <p class="conversation-preview">Clica para ver as mensagens</p>
        </div>

        <button
          class="delete-btn"
          (click)="deleteConversation(conversation.id, $event)"
          title="Delete conversation">
          <span class="material-icons">delete</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Main chat area -->
  <div class="chat-area">
    <div *ngIf="!selectedConversation()" class="welcome-screen">
      <div class="welcome-content">
        <span class="material-icons">chat_bubble_outline</span>
        <h1>Bem-Vindo ao seu Assistante Virtual de Inglês</h1>
        <p>Selecione uma conversa na barra lateral ou crie uma nova para começar.</p>
        <button class="start-chat-btn" (click)="createNewChat()">
          <span class="material-icons">add_comment</span>
          Começar uma nova conversa
        </button>
      </div>
    </div>

    <div *ngIf="selectedConversation()" class="active-chat">
      <!-- Chat Header -->
      <div class="chat-header">
        <div class="chat-title">
          <span class="material-icons">support_agent</span>
          <h3>{{ selectedConversation()!.title }}</h3>
        </div>
      </div>

      <!-- Messages -->
      <div class="chat-messages" #messagesContainer>
        <div *ngIf="messages().length === 0 && !isLoading()" class="empty-chat">
          <span class="material-icons">forum</span>
          <p>Sem mensagens no momento. Comece já!!</p>
        </div>

        <div *ngFor="let message of messages()"
             class="message"
             [class.user-message]="message.isUser"
             [class.bot-message]="!message.isUser">

          <div class="message-content">
            <markdown [data]="message.text"></markdown>
            <span class="message-time">{{ message.timestamp | date:'shortTime' }}</span>
          </div>

          <div class="message-icon"
               [class.user-icon]="message.isUser"
               [class.bot-icon]="!message.isUser">
            <span class="material-icons">
              {{ message.isUser ? 'person' : 'support_agent' }}
            </span>
          </div>
        </div>

        <!-- Typing indicator -->
        <div *ngIf="isTyping" class="message bot-message">
          <div class="message-content typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div class="message-icon bot-icon">
            <span class="material-icons">support_agent</span>
          </div>
        </div>
      </div>

      <!-- Input area -->
      <div class="chat-input">
        <input
          type="text"
          placeholder="Pergunte qualquer coisa sobre Inglês..."
          [(ngModel)]="userMessage"
          (keyup.enter)="sendMessage()">
        <button (click)="sendMessage()" [disabled]="!userMessage.trim()">
          <span class="material-icons">send</span>
        </button>
      </div>
    </div>
  </div>
</div>


